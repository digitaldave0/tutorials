AWSTemplateFormatVersion: 2010-09-09
Description: "Create s3 bucket with autogenerated name"

Conditions:

  IsServiceCatalogDeployment:
    !Equals
      - !Select
        - 0
        - !Split
          - '-'
          - !Ref AWS::StackName
      - SC

Resources:  
  RootRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
           - Effect: Allow
        Action:
           - 's3:ListBucket'
        Resource:
           - 'dahtest'
           - Effect: Allow
             Action:
              - 's3:PutObject'
              - 's3:GetObject'
              - 's3:DeleteObject'
              - 's3:PutObjectAcl'
             Resource:
              - !Sub '${AWS::AccountId}-${AWS::StackName}/*'  
  RootInstanceProfile:
    Type: 'AWS::IAM::InstanceProfile'
    Properties:
      Path: /
      Roles:
        - !Ref RootRole
    
  DavesBucket:
    Type: AWS::S3::Bucket
    BucketName: !Ref DavesBucket

Outputs:
  RootRole:
    Value: !Ref RootRole
    Description: RootRole Created